language: node_js
node_js:
  - '4'

env:
  global:
    - CI=true
    - DEVIRN=arn:aws:iam::552819999234:role/sat-api-dev-r-IamRoleLambda-1EGIOQG7VOZ7G
    - PRODIRN=arn:aws:iam::552819999234:role/sat-api-production-r-IamRoleLambda-UUYN0506SWZE
    # the following are set via travis admin panel
    # ES_HOST
    # AWS_KEY
    # AWS_SECRET

before_install:
  - npm install -g serverless@beta
  - mkdir -p ~/.aws
  - echo '[default]' > ~/.aws/credentials
  - echo 'aws_access_key_id='"$AWS_KEY"'' >> ~/.aws/credentials
  - echo 'aws_secret_access_key='"$AWS_SECRET"'' >> ~/.aws/credentials

install:
  - npm install

script:
  - npm run test

deploy:
  provider: script
  skip_cleanup: true
  script: serverless deploy
  on:
    branch:
      - master
      - develop

language: node_js
node_js:
  - '4'

env:
  - CI=true

before_install:
  - npm install -g serverless@0.5.3
  - mkdir -p ~/.aws
  - echo '[travis]' > ~/.aws/credentials
  - echo 'aws_access_key_id='"$AWS_KEY"'' >> ~/.aws/credentials
  - echo 'aws_secret_access_key='"$AWS_SECRET"'' >> ~/.aws/credentials

install:
  - npm install
  - npm run build
  - sls project init init -s dev -r us-east-1 -c -p travis
  - |-
    cat _meta/variables/s-variables-common.json | jq '. + {"es_host": "'"$ES_HOST"'"}' > tmp && mv tmp _meta/variables/s-variables-common.json
  - cat _meta/variables/s-variables-common.json

script:
  - echo 'nothing'

deploy:
  provider: script
  skip_cleanup: true
  script: ./deploy.sh
  on:
    branch:
      - master
      - develop
